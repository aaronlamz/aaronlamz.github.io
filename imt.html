<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>imToken 快捷支付</title>
</head>
<body>
  <h2>使用 imToken 支付 USDT</h2>
  <p id="status">状态：等待点击付款</p>
  <button onclick="payNow()">立即付款</button>

  <script>
    const toAddress = "0x39eED5Ed04dbFA049890D77B0309Aa1a2D411075"; // 收款地址
    const amount = "10"; // 金额（单位：USDT）
    const token = "USDT"; // 代币标识符（ERC20）

    function payNow() {
      const payUrl = `imtoken://transfer?contract=${token}&to=${toAddress}&value=${amount}`;
      console.log("跳转链接:", payUrl);
      document.getElementById("status").innerText = "即将跳转到 imToken 支付页面...";
      window.location.href = payUrl;
    }

    // 检测是否在 imToken 内部
    window.addEventListener("DOMContentLoaded", () => {
      if (typeof window.imToken !== "undefined") {
        document.getElementById("status").innerText = "imToken 已就绪，可点击付款";
      } else if (!window.location.hash.includes("from=imtoken")) {
        // 自动尝试打开 imToken App 并加载当前页
        const dappUrl = encodeURIComponent(window.location.href + "#from=imtoken");
        const openUrl = `imtokenv2://navigate/DappView?url=${dappUrl}`;
        window.location.href = openUrl;
      } else {
        document.getElementById("status").innerText = "请在 imToken App 中点击付款";
      }
    });
  </script>
</body>
</html>