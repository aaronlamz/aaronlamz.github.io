<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <title>Tron USDT æˆæƒ + æ”¯ä»˜</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
</head>
<body>
  <h2>æˆæƒ + æ”¯ä»˜ USDTï¼ˆçº¯å‰ç«¯ï¼Œæ— éœ€åç«¯ï¼‰</h2>
  <p>æ”¶æ¬¾åœ°å€ï¼š<strong>TQzCCwXvp51b24nzDQCdX2G9ywwJpdgwUq</strong></p>
  <p>æ”¯ä»˜é‡‘é¢ï¼š<input type="number" id="amount" value="1" step="0.01" /> USDT</p>
  <p id="status">çŠ¶æ€ï¼šç­‰å¾…ä¸­...</p>

  <button onclick="authorize()">1ï¸âƒ£ æˆæƒ</button>
  <button onclick="pay()">2ï¸âƒ£ æ”¯ä»˜</button>

  <script>
    const usdtContractAddress = "TR7NHqjeKQxGTCi8q8ZY4pL8otSzgjLj6t"; // USDT åˆçº¦
    const paymentContractAddress = "TCSsh1TmLMfAH82ED6putkkdYDKCCLKkN4"; // ğŸ‘‰ ä½ éƒ¨ç½²çš„åˆçº¦åœ°å€
    const decimals = 6;
    const feeLimit = 100_000_000;

    async function getTronWeb() {
      if (!window.tronWeb || !window.tronWeb.defaultAddress.base58) {
        alert("è¯·åœ¨ imToken æˆ– TronLink ä¸­æ‰“å¼€æœ¬é¡µé¢");
        throw new Error("TronWeb æœªè¿æ¥");
      }
      return window.tronWeb;
    }

    async function authorize() {
      try {
        const tronWeb = await getTronWeb();
        const amount = parseFloat(document.getElementById("amount").value);
        const value = tronWeb.toBigNumber(amount * (10 ** decimals));
        const contract = await tronWeb.contract().at(usdtContractAddress);

        document.getElementById("status").innerText = "â³ æ­£åœ¨æˆæƒ...";
        const tx = await contract.increaseApproval(paymentContractAddress, value).send({ feeLimit });
        document.getElementById("status").innerText = `âœ… æˆæƒæˆåŠŸï¼TxIDï¼š${tx}`;
      } catch (err) {
        document.getElementById("status").innerText = "âŒ æˆæƒå¤±è´¥ï¼š" + (err.message || err);
      }
    }

    async function pay() {
      try {
        const tronWeb = await getTronWeb();
        const amount = parseFloat(document.getElementById("amount").value);
        const value = tronWeb.toBigNumber(amount * (10 ** decimals));
        const contract = await tronWeb.contract().at(paymentContractAddress);

        document.getElementById("status").innerText = "â³ æ­£åœ¨æ”¯ä»˜...";
        const tx = await contract.pay(value).send({ feeLimit });
        document.getElementById("status").innerText = `âœ… æ”¯ä»˜æˆåŠŸï¼TxIDï¼š${tx}`;
      } catch (err) {
        document.getElementById("status").innerText = "âŒ æ”¯ä»˜å¤±è´¥ï¼š" + (err.message || err);
      }
    }
  </script>
</body>
</html>